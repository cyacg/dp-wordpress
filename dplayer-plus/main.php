<?php/*Plugin Name: Dplayer-plus-2Plugin URI: #Description: Dplayer威力加强版-2Version: 1.2Author: CarseasonAuthor URI: https://acgloc.com/$url_C[$p] = 'https://gss3.baidu.com/6LZ0ej3k1Qd3ote6lo7D0j9wehsv/tieba-smallvideo/'.$url_C[$p];*/require_once 'options/options.php';            //引用后台配置文件add_shortcode('dp', 'C_Dplayer');    //短代码/*处理短代码 */function C_Dplayer($list,$con){    /*读取数据库option里的CarVideo字段*/    $Video_data = get_option( 'CarVideo' );      if($Video_data){        $danmuUrl_C       = urldecode($Video_data['danmuUrl']);        $danmukuUrl_C     = urldecode($Video_data['danmukuUrl']);        $danmuEnabled_C   = absint($Video_data['danmuEnabled']);        $logo_C           = urldecode($Video_data['logo']);        $cover_C          = $Video_data['cover'];        $menu_C           = $Video_data['menu'];        $parsers_C        = $Video_data['parsers'];    }    /*处理短代码数据 */    $up_C    =   $list['up'];    $url_C   =   explode(',',$list['url']);    $name_C  =   explode(',',$list['name']);    $len_C   =   count($url_C);    /*获取登录用户昵称 */    global $current_user;    $useru_C =   isset( $current_user->display_name  ) ?   $current_user->display_name    :   "游客";    //用户弹幕ID    $source = 0;    $list_C = '';    $i = 0;    while($i<$len_C){        $t = $i+1;        $list_C .= '<li class="list_C"><a class="multilink-btn btn btn-sm btn-default bordercolor2hover bgcolor2hover current-link" v-on:click="SetVpage('.$t.')"><i class="fa fa-play-circle"></i> '.urldecode($name_C[$i]).'</a></li>';        $i++;    }    $vpage = $_GET["vpage"]; //获取浏览器输入如1.php?vpage=XXXX,即截取XXXX    if ( !is_numeric($vpage) || empty($vpage) || $vpage < 1 || $vpage> $len_C){        $vpage = 1;    }    $p =$vpage-1;    foreach( $parsers_C as $value){        $re_C =  urldecode($value["partter"]);        if ( preg_match( "/".$re_C."/", $url_C[$p] ) && !empty($re_C)  ){            $url_C[$p] = urldecode($value['url']) .$url_C[$p];  //链接赋值            $source = absint($value['sourceType']);             break;        }    }             if($source == 1){        $html = '<iframe-c url="'.$url_C[$p].'"></iframe-c>';    }else{        if(wp_is_mobile()){            $html = '<video-c url="'.$url_C[$p].'" danmuapi="'.$danmuUrl_C.'" md5="'.md5($url_C[$p]).'" user="'.$useru_C.'" logo="'.$logo_C.'" autoplay="'.$autoplay.'" ></video-c>';         }else if($danmuEnabled_C == 0){            $html = '<videodm-c url="'.$url_C[$p].'" danmuapi="'.$danmuUrl_C.'" md5="'.md5($url_C[$p]).'" user="'.$useru_C.'" logo="'.$logo_C.'" dmapi="'.$danmukuUrl_C.'" autoplay="'.$autoplay.'" ></videoDm-c>';        }else{            $html = '<video-c url="'.$url_C[$p].'" danmuapi="'.$danmuUrl_C.'" md5="'.md5($url_C[$p]).'" user="'.$useru_C.'" logo="'.$logo_C.'" autoplay="'.$autoplay.'" ></video-c>';         }    }    $cover_C = json_encode($cover_C);    foreach($menu_C as $key =>$value){        $menu_C[$key]["text"] = urldecode($value["text"]);        $menu_C[$key]["link"] = urldecode($value["link"]);    }    $menu_C  = json_encode($menu_C);    wp_enqueue_script('Dplayer_C', plugins_url('',__FILE__)."/plus-c.js", array(), '1.0', true);    return <<<EOF            <div id="Dplayer_C">                $html			<div class="ep-list-pre-wrapper">                <div class="ep-list-pre-header">                    <span class="season-item on">选集</span>                </div>                <ul id="tm-share" class="num_C"> $list_C</ul>            </div>            <div class="like-bar" style="width:100%"></div>            </div>            <style>ul.num_C li.list_C:nth-child($vpage) a{background: #ff557f;color: #fff;}@media screen and (max-width: 950px){ul.num_C li.list_C{flex: 0 0 25%;max-width: 21.5%;}.dplayer-logo{display: none;}}</style>            <script>	    	var cover = $cover_C;	        var menu  = $menu_C;	    	</script>EOF;}